<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图书馆勤工助学值班记录器</title>
    <!-- 外部资源引入 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1E40AF',
                        secondary: '#3B82F6',
                        library: '#2563EB',
                        circulation: '#059669',
                        clear: '#EA580C',
                        delete: '#DC2626',
                        neutral: '#F8FAFC',
                        card: '#FFFFFF',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 6px 12px -2px rgba(0, 0, 0, 0.04), 0 3px 7px -3px rgba(0, 0, 0, 0.03)',
                        'card-hover': '0 12px 20px -5px rgba(0, 0, 0, 0.06), 0 6px 8px -4px rgba(0, 0, 0, 0.04)',
                        'modal': '0 15px 30px -5px rgba(0, 0, 0, 0.12), 0 8px 15px -6px rgba(0, 0, 0, 0.08)',
                    },
                    borderRadius: {
                        'card': '1rem',
                    }
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .transition-all-300 {
                transition: all 300ms ease-in-out;
            }
            .bg-page {
                background: linear-gradient(180deg, #F9FAFB 0%, #F3F4F6 100%);
            }
            .card-hover {
                transition: all 0.25s ease;
            }
            .card-hover:hover {
                transform: translateY(-2px);
                box-shadow: var(--tw-shadow-card-hover);
            }
            .modal-enter {
                animation: modalFadeIn 0.3s ease forwards;
            }
            @keyframes modalFadeIn {
                from { opacity: 0; transform: scale(0.98); }
                to { opacity: 1; transform: scale(1); }
            }
            .number-animate {
                transition: all 0.4s ease;
            }
        }
    </style>
</head>

<body class="bg-page min-h-screen font-sans text-gray-800 antialiased">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- 标题区域 -->
        <header class="text-center mb-10 mt-4">
            <div class="inline-block bg-primary/10 rounded-full p-3 mb-4">
                <i class="fa fa-book text-primary text-3xl"></i>
            </div>
            <h1 class="text-[clamp(1.8rem,5vw,2.5rem)] font-bold text-gray-800 mb-2 tracking-tight">图书馆勤工助学值班记录</h1>
            <p class="text-gray-600 max-w-2xl mx-auto">便捷记录和管理学生在书库班和流通班的值班次数，数据自动保存在本地</p>
        </header>

        <!-- 学生添加区域 -->
        <div class="bg-card rounded-card shadow-card p-6 mb-8 card-hover">
            <h2 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                <i class="fa fa-user-plus text-primary mr-2"></i>学生管理
            </h2>
            <div class="flex flex-col sm:flex-row gap-4">
                <input 
                    type="text" 
                    id="newPerson" 
                    placeholder="输入单个学生姓名" 
                    class="flex-1 px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/40 focus:border-primary transition-all-300 text-base shadow-sm"
                >
                <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
                    <button id="addBtn" class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg font-medium flex items-center justify-center transition-all-300 transform hover:scale-105 active:scale-95 shadow-sm hover:shadow-md">
                        <i class="fa fa-plus mr-2"></i>单个添加
                    </button>
                    <button id="batchImportBtn" class="bg-secondary hover:bg-secondary/90 text-white px-6 py-3 rounded-lg font-medium flex items-center justify-center transition-all-300 transform hover:scale-105 active:scale-95 shadow-sm hover:shadow-md">
                        <i class="fa fa-upload mr-2"></i>批量导入
                    </button>
                </div>
            </div>
        </div>

        <!-- 操作按钮区 -->
        <div class="flex justify-end mb-6">
            <button id="showSummaryBtn" class="bg-gray-800 hover:bg-gray-700 text-white px-6 py-2.5 rounded-lg font-medium flex items-center transition-all-300 transform hover:scale-105 active:scale-95 shadow-sm">
                <i class="fa fa-list mr-2"></i>显示全部记录
            </button>
        </div>

        <!-- 汇总记录区域 -->
        <div id="summaryArea" class="bg-card rounded-card shadow-card p-6 mb-8 hidden card-hover">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-2">
                <h2 class="text-lg font-semibold text-gray-700 flex items-center">
                    <i class="fa fa-table text-primary mr-2"></i>值班记录汇总
                </h2>
                <span id="summaryDate" class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full"></span>
            </div>
            
            <div class="overflow-x-auto rounded-lg border border-gray-100">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">序号</th>
                            <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">学生姓名</th>
                            <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">书库班数</th>
                            <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">流通班数</th>
                            <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">总次数</th>
                        </tr>
                    </thead>
                    <tbody id="summaryTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- JS 动态填充 -->
                    </tbody>
                    <tfoot class="bg-gray-50">
                        <tr>
                            <td class="py-3 px-6 text-sm font-bold" colspan="2">总计</td>
                            <td class="py-3 px-6 text-sm font-bold text-library" id="summaryTotalLibrary"></td>
                            <td class="py-3 px-6 text-sm font-bold text-circulation" id="summaryTotalCirculation"></td>
                            <td class="py-3 px-6 text-sm font-bold text-primary" id="summaryTotalAll"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <!-- 学生列表区域 -->
        <div class="bg-card rounded-card shadow-card p-6 mb-8 card-hover">
            <h2 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                <i class="fa fa-list-alt text-primary mr-2"></i>学生值班列表
                <span class="ml-2 text-sm text-gray-500">(点击刷新图标可清零对应班次)</span>
            </h2>
            <div id="personList" class="space-y-4">
                <div class="text-gray-500 text-center py-12" id="emptyState">
                    <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 mb-4">
                        <i class="fa fa-info-circle text-2xl opacity-30"></i>
                    </div>
                    <p class="mb-2">还没有添加学生</p>
                    <p class="text-sm text-gray-400">请使用「单个添加」或「批量导入」功能添加学生</p>
                </div>
            </div>
        </div>

        <!-- 统计区域 -->
        <div class="bg-card rounded-card shadow-card p-6 card-hover">
            <h2 class="text-lg font-semibold text-gray-700 mb-5 flex items-center">
                <i class="fa fa-bar-chart text-primary mr-2"></i>值班统计
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                <div class="bg-neutral p-5 rounded-lg border border-gray-100">
                    <p class="text-gray-500 text-sm mb-1">书库班总次数</p>
                    <p class="text-3xl font-bold text-library number-animate" id="totalLibraryDuties">0</p>
                </div>
                <div class="bg-neutral p-5 rounded-lg border border-gray-100">
                    <p class="text-gray-500 text-sm mb-1">流通班总次数</p>
                    <p class="text-3xl font-bold text-circulation number-animate" id="totalCirculationDuties">0</p>
                </div>
                <div class="bg-neutral p-5 rounded-lg border border-gray-100">
                    <p class="text-gray-500 text-sm mb-1">参与学生总数</p>
                    <p class="text-3xl font-bold text-gray-800 number-animate" id="totalPeople">0</p>
                </div>
            </div>
            <button id="resetBtn" class="mt-5 text-delete hover:text-delete/80 text-sm font-medium flex items-center transition-all-300 hover:pl-1">
                <i class="fa fa-refresh mr-1"></i> 重置所有记录
            </button>
        </div>

        <!-- 页脚 -->
        <footer class="mt-10 text-center text-gray-500 text-sm pb-6">
            <p>数据自动保存在本地，刷新页面不会丢失</p>
        </footer>
    </div>

    <!-- 批量导入模态框 -->
    <div id="batchImportModal" class="fixed inset-0 bg-black/30 flex items-center justify-center z-50 hidden">
        <div class="bg-card rounded-card shadow-modal p-6 w-full max-w-2xl modal-enter">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800 flex items-center">
                    <i class="fa fa-upload text-secondary mr-2"></i>批量导入学生
                </h3>
                <button id="closeModalBtn" class="text-gray-400 hover:text-gray-600 transition-all-300">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="bg-gray-50 p-4 rounded-lg mb-4 text-sm text-gray-600">
                <p class="font-medium mb-1">支持以下格式（自动去重）：</p>
                <ul class="list-disc list-inside space-y-1">
                    <li>逗号分隔：张三,李四,王五</li>
                    <li>换行分隔：张三<br>李四<br>王五</li>
                    <li>空格分隔：张三 李四 王五</li>
                    <li>混合分隔：张三,李四 王五<br>赵六</li>
                </ul>
                <p class="mt-2 font-medium">系统会自动处理：</p>
                <ul class="list-disc list-inside space-y-1">
                    <li>导入文本中重复的名字（只保留一个）</li>
                    <li>与系统中已存在的学生重复的名字</li>
                </ul>
            </div>
            
            <textarea 
                id="batchText" 
                rows="6" 
                placeholder="请粘贴学生姓名（支持多种分隔符）..." 
                class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary/40 focus:border-secondary transition-all-300 mb-4"
            ></textarea>
            
            <div class="flex justify-end gap-3">
                <button id="cancelImportBtn" class="px-6 py-2.5 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-all-300">
                    取消
                </button>
                <button id="confirmImportBtn" class="bg-secondary hover:bg-secondary/90 text-white px-6 py-2.5 rounded-lg font-medium transition-all-300 transform hover:scale-105 active:scale-95">
                    <i class="fa fa-check mr-1"></i>确认导入
                </button>
            </div>
            
            <div id="importResult" class="mt-4 p-3 rounded-lg hidden"></div>
        </div>
    </div>

    <script>
        // 数据初始化
        let students = JSON.parse(localStorage.getItem('libraryStudents')) || [];
        
        // DOM 元素缓存
        const DOM = {
            personList: document.getElementById('personList'),
            newPersonInput: document.getElementById('newPerson'),
            addBtn: document.getElementById('addBtn'),
            emptyState: document.getElementById('emptyState'),
            batchImportBtn: document.getElementById('batchImportBtn'),
            batchImportModal: document.getElementById('batchImportModal'),
            closeModalBtn: document.getElementById('closeModalBtn'),
            cancelImportBtn: document.getElementById('cancelImportBtn'),
            confirmImportBtn: document.getElementById('confirmImportBtn'),
            batchText: document.getElementById('batchText'),
            importResult: document.getElementById('importResult'),
            showSummaryBtn: document.getElementById('showSummaryBtn'),
            summaryArea: document.getElementById('summaryArea'),
            summaryTableBody: document.getElementById('summaryTableBody'),
            summaryDate: document.getElementById('summaryDate'),
            summaryTotalLibrary: document.getElementById('summaryTotalLibrary'),
            summaryTotalCirculation: document.getElementById('summaryTotalCirculation'),
            summaryTotalAll: document.getElementById('summaryTotalAll'),
            totalLibraryEl: document.getElementById('totalLibraryDuties'),
            totalCirculationEl: document.getElementById('totalCirculationDuties'),
            totalPeopleEl: document.getElementById('totalPeople'),
            resetBtn: document.getElementById('resetBtn'),
        };

        // 渲染学生列表
        function renderStudents() {
            DOM.personList.innerHTML = '';
            
            if (students.length === 0) {
                DOM.personList.appendChild(DOM.emptyState);
                return;
            }
            
            students.forEach((student, index) => {
                const studentEl = document.createElement('div');
                studentEl.className = 'student-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 border border-gray-100 rounded-lg hover:bg-gray-50 transition-all-300';
                studentEl.innerHTML = `
                    <div class="flex items-center mb-3 sm:mb-0">
                        <div class="w-9 h-9 bg-primary/10 text-primary rounded-full flex items-center justify-center mr-3">
                            <i class="fa fa-user"></i>
                        </div>
                        <span class="font-medium text-gray-800">${student.name}</span>
                    </div>
                    <div class="flex flex-wrap items-center gap-4 w-full sm:w-auto justify-between sm:justify-end">
                        <div class="flex items-center">
                            <span class="text-sm text-gray-600 mr-2">书库班:</span>
                            <span class="bg-library/10 text-library px-3 py-1.5 rounded-full font-semibold min-w-[40px] text-center library-count">
                                ${student.libraryDuty}
                            </span>
                            <button class="increment-library bg-library hover:bg-library/90 text-white p-2 rounded-full ml-2 transition-all-300 transform hover:scale-110 active:scale-95 shadow-sm" data-index="${index}">
                                <i class="fa fa-plus"></i>
                            </button>
                            <button class="clear-duty-btn bg-clear/10 text-clear hover:bg-clear/20 p-2 rounded-full ml-2 transition-all-300 shadow-sm" 
                                    data-index="${index}" data-type="library" title="清零书库班次数">
                                <i class="fa fa-refresh"></i>
                            </button>
                        </div>
                        <div class="flex items-center">
                            <span class="text-sm text-gray-600 mr-2">流通班:</span>
                            <span class="bg-circulation/10 text-circulation px-3 py-1.5 rounded-full font-semibold min-w-[40px] text-center circulation-count">
                                ${student.circulationDuty}
                            </span>
                            <button class="increment-circulation bg-circulation hover:bg-circulation/90 text-white p-2 rounded-full ml-2 transition-all-300 transform hover:scale-110 active:scale-95 shadow-sm" data-index="${index}">
                                <i class="fa fa-plus"></i>
                            </button>
                            <button class="clear-duty-btn bg-clear/10 text-clear hover:bg-clear/20 p-2 rounded-full ml-2 transition-all-300 shadow-sm" 
                                    data-index="${index}" data-type="circulation" title="清零流通班次数">
                                <i class="fa fa-refresh"></i>
                            </button>
                        </div>
                        <button class="delete-btn bg-delete/10 text-delete hover:bg-delete/20 px-4 py-1.5 rounded-lg flex items-center gap-1.5 transition-all-300 shadow-sm" 
                                data-index="${index}" title="删除该学生所有记录">
                            <i class="fa fa-trash"></i>
                            <span>删除</span>
                        </button>
                    </div>
                `;
                DOM.personList.appendChild(studentEl);
            });

            bindEventListeners();
            updateStats();
            saveData();
        }

        // 事件绑定
        function bindEventListeners() {
            document.querySelectorAll('.increment-library').forEach(btn => {
                btn.removeEventListener('click', handleLibraryIncrement);
                btn.addEventListener('click', handleLibraryIncrement);
            });

            document.querySelectorAll('.increment-circulation').forEach(btn => {
                btn.removeEventListener('click', handleCirculationIncrement);
                btn.addEventListener('click', handleCirculationIncrement);
            });

            document.querySelectorAll('.clear-duty-btn').forEach(btn => {
                btn.removeEventListener('click', handleClearDuty);
                btn.addEventListener('click', handleClearDuty);
            });

            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.removeEventListener('click', handleDelete);
                btn.addEventListener('click', handleDelete);
            });
        }

        // 统计更新
        function updateStats() {
            const totalLibrary = students.reduce((sum, student) => sum + student.libraryDuty, 0);
            const totalCirculation = students.reduce((sum, student) => sum + student.circulationDuty, 0);
            
            animateValue(DOM.totalLibraryEl, parseInt(DOM.totalLibraryEl.textContent), totalLibrary, 300);
            animateValue(DOM.totalCirculationEl, parseInt(DOM.totalCirculationEl.textContent), totalCirculation, 300);
            DOM.totalPeopleEl.textContent = students.length;
        }

        // 数字变化动画
        function animateValue(element, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                element.textContent = Math.floor(progress * (end - start) + start);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // 数据持久化
        function saveData() {
            localStorage.setItem('libraryStudents', JSON.stringify(students));
        }

        // 书库班次数增加
        function handleLibraryIncrement(e) {
            e.stopPropagation();
            const index = parseInt(e.currentTarget.dataset.index);
            students[index].libraryDuty++;
            
            const countEl = e.currentTarget.previousElementSibling;
            countEl.classList.add('scale-125', 'font-bold');
            setTimeout(() => countEl.classList.remove('scale-125', 'font-bold'), 300);
            
            renderStudents();
        }

        // 流通班次数增加
        function handleCirculationIncrement(e) {
            e.stopPropagation();
            const index = parseInt(e.currentTarget.dataset.index);
            students[index].circulationDuty++;
            
            const countEl = e.currentTarget.previousElementSibling;
            countEl.classList.add('scale-125', 'font-bold');
            setTimeout(() => countEl.classList.remove('scale-125', 'font-bold'), 300);
            
            renderStudents();
        }

        // 班次清零
        function handleClearDuty(e) {
            e.stopPropagation();
            const index = parseInt(e.currentTarget.dataset.index);
            const dutyType = e.currentTarget.dataset.type;
            
            const dutyName = dutyType === 'library' ? '书库班' : '流通班';
            if (!confirm(`确定要清零${students[index].name}的${dutyName}次数吗？`)) {
                return;
            }
            
            students[index][`${dutyType}Duty`] = 0;
            
            const countEl = e.currentTarget.parentElement.querySelector(`.${dutyType}-count`);
            countEl.classList.add('scale-90', 'text-clear');
            setTimeout(() => countEl.classList.remove('scale-90', 'text-clear'), 300);
            
            renderStudents();
        }

        // 学生删除
        function handleDelete(e) {
            e.stopPropagation();
            const index = parseInt(e.currentTarget.dataset.index);
            
            if (isNaN(index) || index < 0 || index >= students.length) {
                console.error('无效的学生索引:', index);
                return;
            }
            
            if (confirm(`确定要删除${students[index].name}的所有值班记录吗？`)) {
                const studentEl = e.currentTarget.closest('.student-item');
                if (studentEl) {
                    studentEl.classList.add('opacity-0', 'scale-95', 'transition-all-300');
                }
                
                setTimeout(() => {
                    students.splice(index, 1);
                    renderStudents();
                }, 300);
            }
        }

        // 单个添加学生
        function addStudent() {
            const name = DOM.newPersonInput.value.trim();
            
            if (!name) {
                DOM.newPersonInput.classList.add('border-red-300');
                setTimeout(() => DOM.newPersonInput.classList.remove('border-red-300'), 1000);
                alert('请输入学生姓名！');
                return;
            }
            
            const isDuplicate = students.some(student => student.name === name);
            if (isDuplicate) {
                alert('该学生已存在！');
                return;
            }
            
            students.push({ 
                name, 
                libraryDuty: 0, 
                circulationDuty: 0 
            });
            
            DOM.newPersonInput.value = '';
            DOM.newPersonInput.classList.add('border-green-500');
            setTimeout(() => DOM.newPersonInput.classList.remove('border-green-500'), 1000);
            
            renderStudents();
            DOM.newPersonInput.focus();
        }

        // 批量导入学生
        function batchImportStudents() {
            const text = DOM.batchText.value.trim();
            
            if (!text) {
                showImportResult('请粘贴学生姓名后再导入', 'error');
                return;
            }
            
            const rawNames = text
                .split(/[,，\n\r\s;；]+/)
                .map(name => name.trim())
                .filter(name => name);
            
            const uniqueNamesInImport = [...new Set(rawNames)];
            
            if (uniqueNamesInImport.length === 0) {
                showImportResult('未识别到有效学生姓名，请检查格式', 'error');
                return;
            }
            
            const existingNames = new Set(students.map(student => student.name));
            const newNames = uniqueNamesInImport.filter(name => !existingNames.has(name));
            const duplicateNamesInSystem = uniqueNamesInImport.filter(name => existingNames.has(name));
            
            const duplicateCountInImport = rawNames.length - uniqueNamesInImport.length;
            const duplicateDetails = [];
            if (duplicateCountInImport > 0) {
                const nameCountMap = {};
                rawNames.forEach(name => {
                    nameCountMap[name] = (nameCountMap[name] || 0) + 1;
                });
                for (const name in nameCountMap) {
                    if (nameCountMap[name] > 1) {
                        duplicateDetails.push(`${name}（重复${nameCountMap[name]-1}次）`);
                    }
                }
            }
            
            if (newNames.length > 0) {
                const newStudents = newNames.map(name => ({
                    name,
                    libraryDuty: 0,
                    circulationDuty: 0
                }));
                students.push(...newStudents);
                
                saveData();
                renderStudents();
            }
            
            let resultText = '';
            if (newNames.length > 0) {
                resultText += `成功导入 ${newNames.length} 名新学生：${newNames.join('、')}`;
            }
            if (duplicateNamesInSystem.length > 0) {
                resultText += `${newNames.length > 0 ? '，' : ''}系统中已存在 ${duplicateNamesInSystem.length} 名学生，未重复导入：${duplicateNamesInSystem.join('、')}`;
            }
            if (duplicateCountInImport > 0) {
                resultText += `${resultText ? '，' : ''}导入文本中存在 ${duplicateCountInImport} 个重复项，已自动去重：${duplicateDetails.join('、')}`;
            }
            showImportResult(resultText, 'success');
            
            setTimeout(() => {
                closeModal();
            }, 3000);
        }

        // 显示导入结果
        function showImportResult(text, type) {
            DOM.importResult.textContent = text;
            DOM.importResult.classList.remove('hidden', 'bg-green-50', 'text-green-700', 'bg-red-50', 'text-red-700');
            if (type === 'success') {
                DOM.importResult.classList.add('bg-green-50', 'text-green-700');
            } else if (type === 'error') {
                DOM.importResult.classList.add('bg-red-50', 'text-red-700');
            }
            DOM.importResult.classList.remove('hidden');
        }

        // 打开模态框
        function openModal() {
            DOM.batchImportModal.classList.remove('hidden');
            DOM.batchText.value = '';
            DOM.importResult.classList.add('hidden');
            DOM.batchText.focus();
            document.body.style.overflow = 'hidden';
        }

        // 关闭模态框
        function closeModal() {
            DOM.batchImportModal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        // 重置所有记录（改进部分）
        function resetAll() {
            // 无数据时直接返回
            if (students.length === 0) return;
            
            // 增强确认提示，明确说明操作后果
            if (confirm('确定要重置所有记录吗？\n这将清除所有学生信息和值班数据，且无法恢复！')) {
                // 1. 立即清空本地存储，确保数据被删除
                localStorage.removeItem('libraryStudents');
                
                // 2. 清空内存中的数组
                students = [];
                
                // 3. 执行视觉反馈动画
                const studentElements = document.querySelectorAll('.student-item');
                studentElements.forEach((el, i) => {
                    setTimeout(() => {
                        el.classList.add('opacity-0', 'scale-95');
                        // 最后一个元素动画结束后重新渲染
                        if (i === studentElements.length - 1) {
                            setTimeout(() => {
                                renderStudents();
                                // 关闭汇总区域
                                if (!DOM.summaryArea.classList.contains('hidden')) {
                                    toggleSummary();
                                }
                            }, 300);
                        }
                    }, i * 100);
                });
            }
        }

        // 汇总区域切换
        function toggleSummary() {
            if (students.length === 0) {
                alert('没有可显示的值班记录，请先添加学生并记录值班次数');
                return;
            }
            
            if (DOM.summaryArea.classList.contains('hidden')) {
                DOM.summaryArea.classList.remove('hidden');
                DOM.summaryArea.classList.add('opacity-0', 'scale-95');
                setTimeout(() => {
                    DOM.summaryArea.classList.remove('opacity-0', 'scale-95');
                    DOM.summaryArea.classList.add('opacity-100', 'scale-100', 'transition-all-300');
                }, 10);
                updateSummary();
                DOM.summaryArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                DOM.summaryArea.classList.remove('opacity-100', 'scale-100');
                DOM.summaryArea.classList.add('opacity-0', 'scale-95', 'transition-all-300');
                setTimeout(() => {
                    DOM.summaryArea.classList.add('hidden');
                }, 300);
            }
        }

        // 更新汇总表格
        function updateSummary() {
            const now = new Date();
            const formattedDate = `${now.getFullYear()}年${now.getMonth() + 1}月${now.getDate()}日 ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            DOM.summaryDate.textContent = `更新时间: ${formattedDate}`;
            
            DOM.summaryTableBody.innerHTML = '';
            
            students.forEach((student, index) => {
                const total = student.libraryDuty + student.circulationDuty;
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-all-300';
                row.innerHTML = `
                    <td class="py-4 px-6 whitespace-nowrap">${index + 1}</td>
                    <td class="py-4 px-6 whitespace-nowrap">${student.name}</td>
                    <td class="py-4 px-6 whitespace-nowrap text-library">${student.libraryDuty}</td>
                    <td class="py-4 px-6 whitespace-nowrap text-circulation">${student.circulationDuty}</td>
                    <td class="py-4 px-6 whitespace-nowrap font-medium">${total}</td>
                `;
                DOM.summaryTableBody.appendChild(row);
            });
            
            const totalLibrary = students.reduce((sum, student) => sum + student.libraryDuty, 0);
            const totalCirculation = students.reduce((sum, student) => sum + student.circulationDuty, 0);
            const totalAll = totalLibrary + totalCirculation;
            
            DOM.summaryTotalLibrary.textContent = totalLibrary;
            DOM.summaryTotalCirculation.textContent = totalCirculation;
            DOM.summaryTotalAll.textContent = totalAll;
        }

        // 初始化事件监听
        function initEventListeners() {
            DOM.addBtn.addEventListener('click', addStudent);
            DOM.newPersonInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addStudent();
            });
            
            DOM.batchImportBtn.addEventListener('click', openModal);
            DOM.closeModalBtn.addEventListener('click', closeModal);
            DOM.cancelImportBtn.addEventListener('click', closeModal);
            DOM.confirmImportBtn.addEventListener('click', batchImportStudents);
            DOM.batchText.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    batchImportStudents();
                }
            });
            DOM.batchImportModal.addEventListener('click', (e) => {
                if (e.target === DOM.batchImportModal) closeModal();
            });
            
            DOM.resetBtn.addEventListener('click', resetAll);
            DOM.showSummaryBtn.addEventListener('click', toggleSummary);
        }

        // 初始化执行
        initEventListeners();
        renderStudents();
    </script>
</body>
</html>
